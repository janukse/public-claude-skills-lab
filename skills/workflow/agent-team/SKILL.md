---
name: agent-team
description: 에이전트 팀을 생성하고 조율하는 워크플로우. 팀 활성화 확인, 팀원 생성, 작업 분배, 모니터링, 종료까지 전체 팀 라이프사이클을 관리합니다.
argument-hint: "[작업 설명] [--members 팀원수] [--plan-approval] [--display tmux|in-process]"
---

# Agent Team

> **공식 문서**: https://code.claude.com/docs/ko/agent-teams
> 이 스킬은 공식 문서를 기반으로 동작합니다. 최신 동작이 스킬과 다를 경우 공식 문서(`WebFetch`로 확인)를 우선합니다.

## 목적

여러 Claude Code 인스턴스를 팀으로 조율하여 복잡한 작업을 병렬로 수행하는 워크플로우.

- 에이전트 팀 환경 설정 자동 확인 및 활성화 안내
- 작업 분석 후 최적의 팀 구조(역할, 인원) 설계
- 팀원 생성, 작업 분배, 진행 모니터링
- 팀원 종료 및 리소스 정리까지 전체 라이프사이클 관리

## 사용법

```
/agent-team 이 프로젝트의 인증 모듈을 리팩토링해줘
/agent-team PR #42를 보안, 성능, 테스트 관점에서 병렬 코드 리뷰해줘
/agent-team --members 3 프론트엔드/백엔드/테스트 분리 작업
/agent-team --plan-approval 데이터베이스 마이그레이션 스크립트 작성
/agent-team --display tmux API 엔드포인트 5개 병렬 구현
```

### 옵션

| 옵션 | 설명 |
|------|------|
| `[작업 설명]` | 팀이 수행할 작업을 자연어로 기술 |
| `--members N` | 팀원 수 지정 (기본: 작업에 따라 자동 결정, 권장 3-5명) |
| `--plan-approval` | 팀원들이 구현 전 계획 승인을 받도록 설정 |
| `--display tmux\|in-process` | 표시 모드 지정 (기본: auto) |

## Workflow

### Step 0: 공식 문서 확인

`WebFetch`로 공식 문서를 조회하여 최신 동작, 제한사항, 모범 사례를 확인한다:

```
WebFetch:
  url: "https://code.claude.com/docs/ko/agent-teams"
  prompt: "에이전트 팀 사용법, 표시 모드, 모범 사례, 제한사항을 추출해줘"
```

공식 문서에서 확인한 내용을 이후 단계의 기준으로 사용한다.

### Step 1: 환경 확인

에이전트 팀 기능이 활성화되어 있는지 확인한다.

**확인 항목:**

1. `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` 환경 변수가 `1`로 설정되어 있는지 확인
2. 프로젝트 또는 사용자 `settings.json`에 해당 환경 변수가 설정되어 있는지 확인
3. `--display tmux` 옵션 사용 시 분할 창 사용 가능 여부 확인

```bash
echo $CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS
```

**활성화되어 있지 않으면**, 사용자에게 안내한다:

> 에이전트 팀 기능이 비활성화되어 있습니다. 다음 중 하나로 활성화하세요:
>
> **방법 1: settings.json에 추가**
> ```json
> {
>   "env": {
>     "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
>   }
> }
> ```
>
> **방법 2: 셸 환경 변수**
> ```bash
> export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
> ```

`AskUserQuestion`으로 확인:
- "설정 추가 후 계속 진행" — settings.json에 환경 변수를 추가하고 계속
- "이미 설정됨, 계속 진행" — Step 2로 진행
- "취소" — 종료

**`--display tmux` 옵션 사용 시 분할 창 확인:**

```bash
which tmux && echo $TMUX
which it2
echo $TERM_PROGRAM
```

표시 모드 기본값은 `"auto"`:
- tmux 세션 안이면 자동으로 분할 창 모드
- 아니면 자동으로 in-process 모드

분할 창 사용 가능 조건 (하나 이상 충족):
- tmux 세션 안에서 실행 중 (`$TMUX` 존재)
- iTerm2에서 `it2` CLI 설치됨 (`$TERM_PROGRAM` = `iTerm.app`)

**분할 창 사용 불가 시** (`--display tmux` 요청했으나 조건 미충족):

> 현재 분할 창 모드를 사용할 수 없습니다.
>
> **tmux 사용:**
> ```bash
> tmux new -s claude    # 새 세션에서 시작
> claude
> ```
>
> **iTerm2 사용 (권장):**
> ```bash
> tmux -CC              # iTerm2 네이티브 통합 모드
> ```
>
> 현재 상태에서는 in-process 모드로 사용할 수 있습니다.
> in-process 모드에서는 Shift+Down으로 팀원들을 순환하고 직접 메시지를 보낼 수 있습니다.

`AskUserQuestion`으로 확인:
- "tmux 세션에서 재시작" — 안내 후 종료
- "in-process 모드로 계속" — `--display`를 in-process로 변경하고 계속
- "취소" — 종료

### Step 2: 작업 분석 및 팀 설계

사용자가 제공한 작업 설명을 분석하여 최적의 팀 구조를 설계한다.

#### 2a: 팀 적합성 판단

다음 기준으로 에이전트 팀이 적합한지 판단한다:

**적합한 경우 (공식 문서 기반):**
- 연구 및 검토: 여러 팀원이 문제의 다양한 측면을 동시에 조사
- 새로운 모듈 또는 기능: 팀원들이 각각 별도의 부분을 소유
- 경쟁하는 가설로 디버깅: 다양한 이론을 병렬 테스트
- 교차 계층 조율: 프론트엔드, 백엔드, 테스트에 걸친 변경

**부적합한 경우 (subagent 권장):**
- 순차적으로 실행해야 하는 작업
- 동일 파일을 여러 명이 편집해야 하는 경우 (덮어쓰기 발생)
- 작업 간 종속성이 높은 경우
- 결과만 보고받으면 되는 집중된 작업

> **subagent vs 에이전트 팀**: subagent는 결과만 메인 에이전트에게 보고하고 서로 대화하지 않는다. 에이전트 팀은 팀원들이 작업 목록을 공유하고 서로 직접 통신한다. 워커들이 서로 통신해야 하는지 여부에 따라 선택한다.

**부적합하다고 판단되면**, `AskUserQuestion`으로 안내:
- "subagent(Task 도구)로 대신 실행" — 에이전트 팀 대신 subagent 방식 제안
- "그래도 에이전트 팀으로 진행" — 팀 생성 계속
- "취소" — 종료

#### 2b: 팀 구조 설계

작업을 분석하여 다음을 결정한다:

| 항목 | 결정 사항 |
|------|-----------|
| 팀 이름 | 작업 내용을 반영한 kebab-case 이름 |
| 팀원 수 | 3-5명 권장 (--members로 오버라이드 가능) |
| 역할 배분 | 각 팀원의 담당 영역과 역할명 |
| 모델 선택 | 작업 복잡도에 따라 모델 결정 (기본: 상속) |
| 작업 목록 | 팀원당 5-6개 작업, 총 작업 목록 |

> **파일 충돌 방지**: 두 팀원이 동일 파일을 편집하면 덮어쓰기 발생. 각 팀원이 다른 파일 집합을 소유하도록 작업을 분할할 것.

설계 결과를 테이블로 표시한다:

```markdown
## 팀 설계: <팀 이름>

| 팀원 | 역할 | 담당 영역 | 모델 |
|------|------|-----------|------|
| <이름1> | <역할> | <담당 파일/모듈> | <모델> |
| <이름2> | <역할> | <담당 파일/모듈> | <모델> |

### 작업 목록
| ID | 작업 | 담당 | 종속성 |
|----|------|------|--------|
| 1 | <작업 설명> | <팀원 이름> | - |
| 2 | <작업 설명> | <팀원 이름> | #1 |
```

`AskUserQuestion`으로 확인:
- "이대로 팀 생성" — Step 3으로 진행
- "팀 구조 수정" — 사용자가 구조를 수정
- "취소" — 종료

### Step 3: 팀 생성 및 팀원 배치

#### 3a: 팀 생성

`TeamCreate` 도구로 팀을 생성한다:

```
TeamCreate:
  team_name: "<설계된 팀 이름>"
  description: "<작업 설명 요약>"
```

#### 3b: 작업 생성

`TaskCreate` 도구로 설계된 작업 목록을 생성한다. 작업 간 종속성이 있으면 `TaskUpdate`로 `addBlockedBy`를 설정한다.

> **작업 크기 조절**: 너무 작으면 조율 오버헤드가 이점을 초과하고, 너무 크면 팀원이 체크인 없이 너무 오래 작동한다. 함수, 테스트 파일, 검토와 같은 명확한 결과물을 생성하는 자체 포함된 단위로 설계한다.

#### 3c: 팀원 생성

`Task` 도구로 각 팀원을 생성한다:

```
Task:
  name: "<팀원 이름>"
  team_name: "<팀 이름>"
  subagent_type: "general-purpose"
  mode: "<plan 또는 default>"   # --plan-approval이면 "plan"
  prompt: "<역할 설명과 담당 작업 상세 프롬프트>"
```

**팀원 프롬프트에 포함할 내용:**
- 역할과 담당 영역 명시
- 담당 파일/모듈 경로 (다른 팀원의 파일과 겹치지 않도록 명시)
- 작업 목록에서 자신의 작업 확인 방법 (`TaskList` → `TaskGet`)
- 다른 팀원과의 협업 방법 (파일 충돌 방지, `SendMessage`로 직접 통신)
- 완료 시 `TaskUpdate`로 작업 완료 표시

> **팀원 컨텍스트**: 팀원은 CLAUDE.md, MCP servers, skills를 포함한 프로젝트 컨텍스트를 자동 로드하지만, 리더의 대화 기록은 상속하지 않는다. 작업별 세부 사항은 생성 프롬프트에 포함할 것.

#### 3d: 작업 할당

`TaskUpdate`로 각 작업의 `owner`를 해당 팀원 이름으로 설정한다. 팀원들은 자신의 작업을 완료한 후 미할당, 미차단 작업을 자체적으로 선택(self-claim)할 수도 있다.

### Step 4: 모니터링 및 조율

팀이 실행되는 동안 다음을 수행한다.

> **중요**: 리더는 팀원들이 작업을 완료할 때까지 기다려야 한다. 리더가 직접 작업을 구현하기 시작하면 안 된다.

#### 4a: 진행 상황 확인

`TaskList`로 전체 작업 상태를 주기적으로 확인한다:

```markdown
## 팀 진행 상황

| 작업 | 담당 | 상태 |
|------|------|------|
| <작업 설명> | <팀원> | pending/in_progress/completed |
```

#### 4b: 팀원 메시지 처리

팀원들의 메시지가 자동으로 전달된다. 다음에 따라 처리:

- **완료 보고** → 결과 확인 후 다음 작업 할당
- **도움 요청** → 직접 안내하거나 다른 팀원에게 연결
- **계획 승인 요청** (`--plan-approval` 모드) → 계획을 검토하고 `SendMessage`의 `plan_approval_response`로 승인/거부. 리더가 자율적으로 판단하되, 프롬프트에 명시된 기준이 있으면 따른다.
- **유휴 알림** → 정상적인 상태. 팀원이 메시지를 보낸 후 유휴 전환되는 것은 정상 동작. 필요 시 새 작업 할당.

#### 4c: 문제 대응

- **팀원이 막힌 경우**: 직접 메시지로 안내하거나 작업을 다른 팀원에게 재할당
- **팀원이 오류에서 중지**: 추가 지시를 보내거나 대체 팀원 생성
- **파일 충돌 감지**: 충돌 파일을 알리고 담당을 재조정
- **작업 상태 지연**: 팀원이 작업을 완료로 표시하지 못하면 `TaskUpdate`로 수동 업데이트

### Step 5: 결과 종합

모든 작업이 완료되면 결과를 종합한다:

```markdown
## 팀 작업 결과

### 완료된 작업
| 작업 | 담당 | 결과 요약 |
|------|------|-----------|
| <작업> | <팀원> | <결과> |

### 주요 발견/변경 사항
- <사항 1>
- <사항 2>

### 후속 작업 (있는 경우)
- <후속 작업>
```

### Step 6: 팀 종료 및 정리

#### 6a: 팀원 종료

각 팀원에게 `SendMessage`의 `shutdown_request`를 보낸다:

```
SendMessage:
  type: "shutdown_request"
  recipient: "<팀원 이름>"
  content: "모든 작업이 완료되었습니다. 종료합니다."
```

모든 팀원이 종료될 때까지 대기한다. 팀원은 현재 요청/도구 호출을 마친 후 종료되므로 시간이 걸릴 수 있다.

#### 6b: 팀 리소스 정리

모든 팀원이 종료된 후 `TeamDelete`로 팀 리소스를 정리한다.

**주의:**
- 활성 팀원이 있으면 정리가 실패한다. 반드시 모든 팀원을 먼저 종료할 것.
- 항상 **리더**가 정리를 실행해야 한다. 팀원이 정리를 실행하면 안 된다.

#### 6c: 고아 tmux 세션 정리

분할 창 모드에서 팀이 끝난 후 tmux 세션이 남아 있으면:
```bash
tmux ls                          # 세션 목록 확인
tmux kill-session -t <session>   # 팀 세션 종료
```

## 팀 설계 가이드

### 역할 패턴

| 패턴 | 역할 구성 | 적합한 작업 |
|------|-----------|-------------|
| **관점별 분리** | 보안, 성능, 테스트 | PR 코드 리뷰 |
| **계층별 분리** | 프론트엔드, 백엔드, DB | 풀스택 기능 구현 |
| **모듈별 분리** | 모듈 A, 모듈 B, 모듈 C | 병렬 리팩토링 |
| **가설 검증** | 가설 1, 가설 2, 가설 3 | 복잡한 디버깅 |
| **연구 분담** | 주제 A, 주제 B, 종합 | 기술 조사 |

### 팀 규모 가이드

| 팀원 수 | 적합한 경우 |
|---------|-------------|
| 2-3명 | 단순 병렬 작업, 관점 비교 |
| 3-5명 | 대부분의 워크플로우 (권장) |
| 5명+ | 대규모 독립 모듈 병렬 작업 (비용 주의) |

> 팀원 수에 하드 제한은 없으나, 토큰 비용이 선형 증가하고 조율 오버헤드가 커진다. 3명의 집중된 팀원이 5명의 산만한 팀원보다 낫다.

### 비용 고려

- 각 팀원은 독립된 Claude 인스턴스로 별도 토큰을 소비
- 팀원 수에 비례하여 토큰 비용이 증가
- `broadcast` 메시지는 팀원 수만큼 비용 발생 → 가급적 `message` 사용
- 일상적인 작업에는 단일 세션이나 subagent가 더 비용 효율적

### 표시 모드

| 모드 | 설명 | 요구사항 |
|------|------|----------|
| **in-process** | 모든 팀원이 메인 터미널 내에서 실행. Shift+Down으로 순환. | 없음 (모든 터미널) |
| **분할 창** | 각 팀원이 자신의 창에서 실행. 한 번에 모두 볼 수 있음. | tmux 또는 iTerm2 (`it2` CLI) |
| **auto** (기본) | tmux 세션 안이면 분할 창, 아니면 in-process | - |

> **주의**: 분할 창은 VS Code 통합 터미널, Windows Terminal, Ghostty에서 미지원.

## 예외사항

### 에이전트 팀 미활성화
`CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS`가 설정되지 않으면 활성화 방법을 안내하고 종료한다.

### 단순 작업
병렬 실행의 이점이 없는 단순 작업이면 "이 작업은 단일 세션이나 subagent가 더 적합합니다."를 안내하고 대안을 제시한다.

### --display tmux 사용 불가
분할 창 모드는 다음 조건 중 하나를 충족해야 동작한다:
1. 현재 Claude Code가 tmux 세션 안에서 실행 중 (`$TMUX` 존재)
2. iTerm2에서 `it2` CLI가 설치되어 있고 Python API가 활성화됨

조건 미충족 시 in-process 모드로 대체하거나, tmux 세션에서 재시작을 안내한다.

### 세션 재개 불가
in-process 팀원은 `/resume`이나 `/rewind`로 복원되지 않는다. 세션 재개 후 리더가 존재하지 않는 팀원에게 메시지를 보내려 할 수 있다. 이 경우 새 팀원을 생성해야 한다.

### 세션당 하나의 팀
리더는 한 번에 하나의 팀만 관리 가능. 새 팀을 시작하기 전에 현재 팀을 정리할 것.

### 중첩된 팀 불가
팀원들은 자신의 팀이나 팀원을 생성할 수 없다. 리더만 팀을 관리할 수 있다.

### 리더 고정
팀을 만드는 세션이 수명 동안 리더. 팀원을 리더로 승격하거나 이전할 수 없다.

### 권한 상속
팀원들은 리더의 권한 설정으로 시작한다. 생성 후 개별 팀원 모드를 변경할 수 있지만, 생성 시점에 팀원별 모드를 설정할 수 없다.

## Hooks (품질 게이트)

Hooks를 사용하여 팀원의 동작에 규칙을 적용할 수 있다:

| Hook | 설명 |
|------|------|
| `TeammateIdle` | 팀원이 유휴 상태가 되려 할 때 실행. 종료 코드 2로 종료하면 피드백을 보내고 팀원을 계속 작동시킨다. |
| `TaskCompleted` | 작업이 완료로 표시될 때 실행. 종료 코드 2로 종료하면 완료를 방지하고 피드백을 보낸다. |

## Related Files

| File | Purpose |
|------|---------|
| `~/.claude/teams/{team-name}/config.json` | 팀 구성 파일 (멤버 목록) |
| `~/.claude/tasks/{team-name}/` | 팀 공유 작업 목록 디렉토리 |
| `settings.json` | `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` 환경 변수 설정 |
| `CLAUDE.md` | 팀원들이 자동으로 로드하는 프로젝트 지침 |

## 참고 자료

- **공식 문서**: https://code.claude.com/docs/ko/agent-teams
- **권한 설정**: https://code.claude.com/docs/ko/permissions
- **Hooks**: https://code.claude.com/docs/ko/hooks
- **Subagents 비교**: https://code.claude.com/docs/ko/sub-agents
- **비용**: https://code.claude.com/docs/ko/costs#agent-team-token-costs
