---
name: doc-sync
description: 프로젝트 내 MD 문서와 실제 코드베이스의 불일치를 감지하고, 수정안을 제안한 뒤 승인 후 적용합니다.
argument-hint: "[대상 경로]"
---

# Doc Sync

## 목적

프로젝트의 MD 문서가 실제 코드베이스와 일치하는지 검증하고, 불일치를 수정하는 문서 현행화 워크플로우.

- 문서에 언급된 파일/디렉토리 경로가 실제로 존재하는지 검증
- README 목록/테이블에 누락된 항목 감지
- 문서 내 코드 참조(함수명, 설정값, API 등)와 실제 코드 불일치 감지
- 불일치 항목별 수정안 제안 및 사용자 승인 후 적용

## 사용법

```
/doc-sync                    # 프로젝트 전체 MD 문서 점검
/doc-sync src/               # 특정 디렉토리 내 MD 문서만 점검
/doc-sync README.md          # 특정 파일만 점검
```

### 옵션

| 옵션 | 설명 |
|------|------|
| `[경로]` | 특정 파일이나 디렉토리만 대상으로 지정. 생략 시 프로젝트 전체 |

## Workflow

### Step 1: 대상 MD 문서 수집

프로젝트 내 MD 파일을 탐색한다.

**인수가 있는 경우:**
- 파일 경로면 해당 파일만 대상
- 디렉토리 경로면 해당 디렉토리 하위의 모든 `*.md` 파일 대상

**인수가 없는 경우:**
- 프로젝트 루트부터 전체 `*.md` 파일 탐색
- `node_modules/`, `.git/`, `dist/`, `build/`, `vendor/` 등 일반적인 제외 디렉토리는 건너뛴다

수집 결과를 테이블로 정리한다:

```markdown
| # | 파일 | 크기 |
|---|------|------|
| 1 | README.md | 2.1KB |
| 2 | docs/api.md | 5.3KB |
```

**MD 파일이 없으면** "대상 MD 문서가 없습니다."를 출력하고 즉시 종료한다.

### Step 2: 불일치 감지

각 MD 파일을 읽고 다음 3가지 유형의 불일치를 검사한다.

#### 2a: 구조 불일치 — 파일/디렉토리 경로 검증

MD 문서에서 참조하는 파일 경로를 추출하여 실제 존재 여부를 확인한다.

**추출 대상:**
- 마크다운 링크: `[텍스트](경로)`
- 코드 블록 내 경로: `src/app.ts`, `./config/settings.json` 등
- 테이블 내 경로 컬럼
- 디렉토리 트리 표기: `├── src/`, `└── index.ts` 등

**검증 방법:**
- 상대 경로는 해당 MD 파일 위치 기준으로 해석
- 프로젝트 루트 기준 경로도 함께 검증
- URL(http/https)은 제외
- 앵커 링크(`#섹션`)는 같은 문서 내 헤딩 존재 여부 확인

**불일치 판정:**
- 참조된 경로에 파일/디렉토리가 존재하지 않음
- 파일이 다른 위치로 이동됨 (유사 이름 파일 탐색으로 후보 제시)

#### 2b: 목록/테이블 누락 감지

MD 문서의 목록이나 테이블이 실제 디렉토리 내용과 일치하는지 확인한다.

**감지 대상:**
- README의 스킬/모듈/컴포넌트 목록 테이블
- 디렉토리 구조 설명
- 설정값/옵션 테이블

**검증 방법:**
- 테이블에 나열된 항목과 실제 디렉토리 내 항목을 비교
- 새로 추가되었으나 테이블에 없는 항목 감지
- 테이블에 있으나 실제로 삭제된 항목 감지

#### 2c: 코드 내용 불일치 감지

MD 문서에서 참조하는 코드 요소가 실제 코드와 일치하는지 확인한다.

**감지 대상:**
- 함수명, 클래스명, 변수명 참조
- API 엔드포인트 경로
- 설정 키/값
- CLI 명령어, 스크립트명
- 코드 블록 내 import 경로

**검증 방법:**
- 문서에 언급된 식별자를 코드베이스에서 Grep으로 검색
- 존재하지 않는 식별자를 불일치로 판정
- 유사 이름이 있으면 이름 변경 가능성을 제시

### Step 3: 불일치 리포트

감지된 불일치를 유형별로 정리하여 표시한다.

```markdown
## 문서 동기화 리포트

### 검사 요약
| 항목 | 값 |
|------|-----|
| 검사한 MD 파일 수 | 12 |
| 발견된 불일치 | 5 |
| 구조 불일치 | 2 |
| 목록 누락 | 2 |
| 코드 불일치 | 1 |

### 불일치 상세

#### 구조 불일치
| # | 파일 | 참조 경로 | 상태 | 제안 |
|---|------|-----------|------|------|
| 1 | README.md:15 | `src/old-file.ts` | 파일 없음 | `src/new-file.ts`로 변경 |
| 2 | docs/guide.md:42 | `config/` | 디렉토리 없음 | 해당 섹션 삭제 |

#### 목록/테이블 누락
| # | 파일 | 테이블/목록 | 누락 항목 | 제안 |
|---|------|-------------|-----------|------|
| 1 | README.md:8 | 스킬 목록 | `new-skill` | 테이블에 행 추가 |
| 2 | README.md:8 | 스킬 목록 | `deleted-skill` | 테이블에서 행 삭제 |

#### 코드 내용 불일치
| # | 파일 | 참조 | 실제 | 제안 |
|---|------|------|------|------|
| 1 | docs/api.md:23 | `getUserById()` | `findUserById()` | 함수명 변경 |
```

**불일치가 없으면** "모든 문서가 최신 상태입니다."를 출력하고 종료한다.

### Step 4: 수정안 제안 및 적용

각 불일치 항목에 대해 구체적인 수정안을 생성한다.

#### 수정안 표시

각 수정에 대해 변경 전/후를 diff 형식으로 표시한다:

```markdown
### 수정 #1: README.md:15
- **유형**: 구조 불일치 — 존재하지 않는 파일 참조
- **변경 내용**:
  ```diff
  - [old-file](src/old-file.ts)
  + [new-file](src/new-file.ts)
  ```
```

#### 사용자 확인

모든 수정안을 표시한 후 `AskUserQuestion`으로 확인한다:

- "전체 적용" — 모든 수정안을 적용
- "선택 적용" — 적용할 항목 번호를 지정
- "적용 안 함" — 리포트만 확인하고 종료

**적용 실행:**
- 승인된 수정안을 해당 MD 파일에 Edit 도구로 적용
- 각 파일 수정 후 정상 적용되었는지 확인

### Step 5: 최종 요약

수정 적용 결과를 요약한다:

```markdown
## 최종 결과

| 항목 | 값 |
|------|-----|
| 검사한 파일 | 12개 |
| 발견된 불일치 | 5개 |
| 수정 적용 | 4개 |
| 수정 건너뜀 | 1개 |

수정된 파일:
- README.md (2건)
- docs/api.md (1건)
- docs/guide.md (1건)
```

## 감지 규칙 상세

### 경로 참조 추출 패턴

| 패턴 | 예시 | 설명 |
|------|------|------|
| `[text](path)` | `[설정](config/app.ts)` | 마크다운 링크 |
| 백틱 내 경로 | `` `src/utils.ts` `` | 인라인 코드 내 경로 |
| 테이블 셀 경로 | `\| src/app.ts \|` | 테이블 내 경로 |
| 트리 표기 | `├── src/` | 디렉토리 트리 |

### 제외 대상

| 대상 | 이유 |
|------|------|
| URL (`http://`, `https://`) | 외부 링크는 검증 범위 밖 |
| 패키지명 (`lodash`, `react`) | npm 패키지는 파일 경로가 아님 |
| 셸 명령어 (`npm install`, `git add`) | 명령어는 파일 참조가 아님 |
| 플레이스홀더 (`<your-path>`, `<파일명>`) | 템플릿 변수는 실제 경로가 아님 |
| 주석 내 경로 (`<!-- ... -->`) | HTML 주석은 무시 |

## 예외사항

### 템플릿 파일
`*.template`, `*.example` 등 템플릿 파일의 플레이스홀더 경로는 불일치로 판정하지 않는다.

### 외부 URL
`http://`, `https://`로 시작하는 URL은 검증 대상에서 제외한다. 외부 링크 유효성 검사는 이 스킬의 범위가 아니다.

### 빈 프로젝트
MD 파일이 하나도 없으면 "대상 MD 문서가 없습니다."를 출력하고 종료한다.

### 대규모 프로젝트
MD 파일이 50개를 초과하면, 파일 목록을 표시하고 `AskUserQuestion`으로 전체 진행 여부를 확인한다.

## Related Files

이 스킬은 단일 파일(`SKILL.md`)로 구성되며, 외부 의존성이 없습니다.
프로젝트의 모든 `*.md` 파일과 해당 파일이 참조하는 코드베이스를 대상으로 동작합니다.
