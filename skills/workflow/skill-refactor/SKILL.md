---
name: skill-refactor
description: 길어진 스킬을 분석하여 분리 전략을 제안하고, 더 작고 효율적인 스킬들로 리팩토링합니다.
argument-hint: "[선택: SKILL.md 경로]"
---

# Skill Refactor

## 목적

길어진 스킬(SKILL.md)을 분석하여 구조적 문제를 진단하고, 적절한 분리 전략을 제안한 후, 더 작고 효율적인 스킬들로 리팩토링하는 워크플로우.

- 스킬의 줄 수, 섹션 수, 관심사 수 등 구조 분석
- 5가지 분리 전략 패턴 중 최적 전략 제안
- 새 스킬 생성 + catalog.json/README 자동 업데이트
- 분리 전/후 검증 및 보고서 생성

## 사용법

```
/skill-refactor                                    # 대화형으로 대상 스킬 선택
/skill-refactor custom/development/code-convention  # 특정 스킬 경로 지정
/skill-refactor SKILL.md                           # SKILL.md 직접 경로 지정
```

### 옵션

| 옵션 | 설명 |
|------|------|
| `[경로]` | 리팩토링 대상 스킬의 디렉토리 경로 또는 SKILL.md 파일 경로 |

## Workflow

### Step 1: 대상 스킬 분석

#### 1a: 대상 선택

인수로 경로가 주어진 경우, 해당 경로의 SKILL.md를 읽는다.

- 디렉토리 경로면 `<경로>/SKILL.md`를 읽는다
- 파일 경로면 해당 파일을 직접 읽는다

**인수가 없으면** `catalog.json`을 읽어 등록된 스킬 목록을 표시하고, `AskUserQuestion`으로 대상을 선택한다.

**파일이 존재하지 않으면** "지정된 경로에 SKILL.md가 없습니다."를 출력하고 종료한다.

#### 1b: 구조 분석

Read 도구로 SKILL.md를 읽고 다음 항목을 분석한다:

| 분석 항목 | 측정 방법 |
|-----------|-----------|
| 총 줄 수 | 파일 전체 줄 수 |
| 스킬 유형 | Guide/Verify 패턴 → Guide/Verify, Step 3개+ → 워크플로우, 그 외 → 단순 도구 |
| 섹션 수 | `##` 레벨 헤더 수 |
| 하위 섹션 수 | `###` 레벨 헤더 수 |
| 규칙/항목 수 | `####` 레벨 헤더 수 |
| 모드 수 | `[Guide 모드]`, `[Verify 모드]` 등 모드 패턴 수 |
| 코드 블록 수 | ` ``` ` 쌍의 수 |
| 관심사 그룹 | `##` 또는 `###` 헤더를 기준으로 독립적인 주제 영역 식별 |

`catalog.json`에서 해당 스킬의 메타데이터도 확인한다:
- 현재 버전
- dependencies 필드
- tags 필드
- 이 스킬을 의존하는 다른 스킬 목록

분석 결과를 테이블로 출력한다:

```markdown
## 스킬 분석 결과

| 항목 | 값 |
|------|-----|
| 스킬명 | code-convention |
| 경로 | custom/development/code-convention |
| 스킬 유형 | Guide/Verify (권장 ~400줄, 현재 1,596줄 — **강력 권장 초과**) |
| 총 줄 수 | 1,596 |
| 섹션(##) 수 | 8 |
| 하위 섹션(###) 수 | 22 |
| 규칙(####) 수 | 43 |
| 모드 수 | 2 (Guide, Verify) |
| 코드 블록 수 | 85 |
| 관심사 그룹 | G1~G9 (9개 카테고리) |
| 현재 버전 | 1.0.0 |
| 의존 스킬 | 없음 |
| 피의존 스킬 | code-convention-react, code-convention-vue3, code-convention-node |
```

### Step 2: 분리 필요성 판단

분석 결과를 기반으로 분리 필요성을 판단한다.

#### 유형별 권장 줄 수

스킬 유형에 따라 권장 줄 수가 다르다. Claude Code는 스킬 호출 시 SKILL.md 전체를 컨텍스트 윈도우에 로드하므로, 스킬이 길수록 컨텍스트 공간이 줄어들고 지시사항 준수도가 저하될 수 있다.

| 스킬 유형 | 권장 | 검토 수준 | 강력 권장 수준 | 예시 |
|-----------|------|-----------|---------------|------|
| **워크플로우** (프로세스/절차 중심) | ~300줄 | 400줄+ | 500줄+ | smart-commit, feature-planner |
| **Guide/Verify** (규칙 정의 중심) | ~400줄 | 600줄+ | 800줄+ | code-convention 시리즈 |
| **단순 도구** (단일 기능) | ~200줄 | 300줄+ | 400줄+ | verify-implementation |

**유형 판별 기준:**
- `[Guide 모드]`/`[Verify 모드]` 패턴이 있으면 → Guide/Verify 유형
- `### Step N:` 패턴이 3개 이상이면 → 워크플로우 유형
- 그 외 → 단순 도구 유형

#### 구조적 분리 기준

줄 수 외에 다음 구조적 기준도 함께 판단한다:

| 기준 | 검토 수준 | 강력 권장 수준 |
|------|-----------|---------------|
| **관심사 수** | 독립적 관심사 3개 이상 | 5개 이상 |
| **모드별 크기** | 2개 이상 모드, 각 150줄 이상 | 각 300줄 이상 |
| **규칙 수** | 20개 이상 | 40개 이상 |
| **워크플로우 Step 크기** | 개별 Step이 100줄 이상 | 200줄 이상 |

#### 판단 로직

1. 먼저 스킬 유형을 판별한다 (Guide/Verify, 워크플로우, 단순 도구)
2. 해당 유형의 줄 수 기준과 구조적 기준을 함께 평가한다

- **유형별 강력 권장 줄 수를 초과하거나, 구조적 강력 권장 기준에 1개 이상 해당** → "분리를 강력히 권장합니다" + 유형/이유 설명
- **유형별 검토 줄 수를 초과하거나, 구조적 검토 기준에 2개 이상 해당** → "분리를 검토해볼 수 있습니다" + 유형/이유 설명
- **모두 미달** → "현재 스킬 크기는 적절합니다. 분리가 필요하지 않습니다." + 이유 출력 후, `AskUserQuestion`으로 계속 진행 여부 확인:
  - "그래도 분리 진행" — Step 3로 계속
  - "종료" — 워크플로우 종료

### Step 3: 분리 전략 제안

스킬의 구조와 내용을 기반으로 적합한 분리 전략을 제안한다.

#### 분리 전략 패턴

##### 전략 A: 확장 스킬 분리 (Core + Extension)

공통 규칙을 Core에 유지, 도메인별 규칙을 별도 확장 스킬로 분리. `dependencies`로 Core 참조.

**적합:** 카테고리별 독립적 규칙 그룹이 있고, 선택적 적용이 필요한 경우.
**사례:** `code-convention` → `code-convention-react`, `code-convention-vue3`, `code-convention-node`

##### 전략 B: 모드 분리

Guide/Verify 등 동작 모드를 별도 스킬로 분리.

**적합:** 2개 이상 모드가 각각 150줄 이상이고, 모드별 도구/접근 방식이 다른 경우.

##### 전략 C: 단계 분리

워크플로우의 대형 Step을 독자적인 스킬로 추출.

**적합:** 특정 Step이 100줄 이상이고, 독자적 가치/재사용 가능성이 있는 경우.

##### 전략 D: 도메인 분리

기술 도메인별로 규칙이나 워크플로우를 별도 스킬로 분리.

**적합:** 하나의 스킬이 여러 기술 도메인을 다루고, 사용자가 특정 도메인만 필요로 하는 경우.

##### 전략 E: 공통 추출

여러 스킬에서 반복되는 패턴이나 규칙을 공통 스킬로 추출.

**적합:** 여러 기존 스킬에서 동일한 로직이 반복되고, 한 곳에서 관리하고 싶은 경우.

#### 전략 선택 및 제안

스킬의 구조를 분석하여 가장 적합한 전략을 선택하고, 구체적인 분리 계획을 제안한다:

```markdown
## 분리 전략 제안

**추천 전략:** 전략 A — 확장 스킬 분리 (Core + Extension)

**선택 이유:**
- 9개의 독립적 관심사 카테고리(G1~G9)가 존재
- 각 카테고리가 독립적으로 사용 가능
- 기존 확장 스킬(react, vue3, node)이 이미 이 패턴을 사용 중

### 분리 계획

| # | 새 스킬명 | 범위 | 예상 줄 수 | dependencies |
|---|-----------|------|-----------|--------------|
| 1 | code-convention (Core 경량화) | G1-G4 공통 규칙 + Verify 기본 프레임 | ~600줄 | — |
| 2 | code-convention-security | G9 보안 규칙 | ~250줄 | [code-convention] |
| 3 | code-convention-testing | G7 테스트 규칙 | ~150줄 | [code-convention] |
```

`AskUserQuestion`으로 사용자에게 확인한다:
- "제안대로 분리" — Step 4로 진행
- "전략 수정" — 사용자의 수정 의견을 반영하여 재제안
- "다른 전략 적용" — 다른 전략 패턴으로 재분석
- "취소" — 워크플로우 종료

### Step 4: 리팩토링 실행

사용자가 승인한 분리 계획에 따라 실제 리팩토링을 수행한다.

#### 4a: 새 스킬 디렉토리 생성

분리 계획의 각 새 스킬에 대해:

```bash
mkdir -p custom/<category>/<new-skill-name>
```

#### 4b: 새 SKILL.md 작성

각 새 스킬의 SKILL.md를 작성한다:

1. YAML 프론트매터 생성 (name, description, argument-hint)
2. 원본 스킬에서 해당 섹션의 내용을 이동
3. 필요한 참조 관계 추가 (기반 스킬 설명, 적용 우선순위 등)
4. 예외사항과 Related Files 섹션 업데이트

**확장 스킬(전략 A)의 경우** `code-convention-react`의 패턴을 참조한다:
- "기반 스킬" 섹션에서 Core 스킬 참조
- "적용 우선순위" 명시 (확장 > Core, 충돌 시 확장 우선)
- Verify 모드에서 Core 검증 병행 안내

#### 4c: 원본 SKILL.md 경량화

원본 스킬에서 분리된 섹션을 제거하고, 확장 스킬 참조 테이블로 대체한다:

```markdown
## 확장 스킬

이 스킬은 **Core** 규칙을 다룹니다. 추가 규칙은 확장 스킬을 사용하세요:

| 스킬 | 대상 | 설명 |
|------|------|------|
| `<extension-1>` | <대상> | <설명> |
| `<extension-2>` | <대상> | <설명> |

확장 스킬은 이 Core 스킬의 규칙을 상속하며, 충돌 시 확장 스킬의 규칙이 우선합니다.
```

#### 4d: catalog.json 업데이트

1. 원본 스킬의 버전을 올린다 (예: 1.0.0 → 2.0.0)
2. 각 새 스킬의 항목을 추가한다:

```json
{
  "name": "<new-skill-name>",
  "version": "1.0.0",
  "description": "<설명>",
  "category": "<원본과 동일 카테고리>",
  "source": "custom",
  "path": "custom/<category>/<new-skill-name>",
  "author": {
    "name": "claude-skills-lab",
    "url": null
  },
  "origin": {
    "repo": null,
    "license": null
  },
  "dependencies": ["<core-skill-name>"],
  "tags": ["<관련 태그>"],
  "files": ["SKILL.md"]
}
```

3. 기존에 원본 스킬을 `dependencies`로 참조하던 스킬들은 영향도를 확인하고, 변경이 필요하면 알려준다.

#### 4e: README 업데이트

1. **메인 README.md** — 스킬 목록 테이블에 새 스킬 행 추가
2. **카테고리 README** — 해당 `custom/<category>/README.md`에 새 스킬 항목 추가

### Step 5: 검증 및 완료

#### 5a: 파일 검증

다음을 확인한다:

1. **파일 존재:** 모든 새 스킬의 `SKILL.md` 파일이 존재하는지
2. **YAML 프론트매터:** 각 SKILL.md에 `name`, `description` 필드가 있는지
3. **catalog.json 일관성:**
   - 각 스킬의 `path` 필드가 실제 디렉토리 경로와 일치하는지
   - `source` 필드가 `"custom"`이고 `path`가 `custom/`으로 시작하는지
   - `dependencies`가 존재하는 스킬명을 참조하는지
4. **내용 커버리지:** 원본의 모든 섹션이 분리된 스킬들에 포함되어 있는지

#### 5b: 결과 보고서

검증 완료 후 결과 보고서를 출력한다:

```markdown
## 스킬 리팩토링 결과

### 분리 전/후 비교

| 항목 | 분리 전 | 분리 후 |
|------|---------|---------|
| 스킬 수 | 1 | 3 |
| 원본 줄 수 | 1,596줄 | 600줄 (Core) |
| 총 줄 수 | 1,596줄 | 1,000줄 (합계) |

### 생성/수정된 파일

| 파일 | 작업 |
|------|------|
| `custom/<category>/<skill>/SKILL.md` | 수정 (경량화) |
| `custom/<category>/<new-1>/SKILL.md` | 신규 생성 |
| `custom/<category>/<new-2>/SKILL.md` | 신규 생성 |
| `catalog.json` | 수정 (2개 항목 추가) |
| `README.md` | 수정 (2개 행 추가) |
| `custom/<category>/README.md` | 수정 (2개 항목 추가) |

### catalog.json 변경 요약

- `<original-skill>` 버전: 1.0.0 → 2.0.0
- 신규: `<new-skill-1>` v1.0.0 (dependencies: [<original>])
- 신규: `<new-skill-2>` v1.0.0 (dependencies: [<original>])
```

## 분리 전략 참조

### 전략 선택 가이드

| 스킬 특성 | 추천 전략 |
|-----------|-----------|
| 카테고리별 규칙 그룹이 독립적 | A. 확장 스킬 분리 |
| Guide/Verify 모드가 각각 크고 독립적 | B. 모드 분리 |
| 워크플로우의 특정 Step이 독자적 가치가 있음 | C. 단계 분리 |
| 여러 기술 도메인을 한 스킬에서 다룸 | D. 도메인 분리 |
| 여러 스킬에서 동일 로직이 반복 | E. 공통 추출 |

### 분리 시 주의사항

- **과도한 분리 금지:** 분리 후 각 스킬이 100줄 미만이면 오히려 관리 부담이 증가한다. 분리 후 각 스킬이 최소 100줄 이상이 되도록 한다.
- **의존성 깊이 제한:** dependencies 체인이 3단계를 넘지 않도록 한다 (A → B → C까지).
- **네이밍 일관성:** 분리된 스킬명은 원본 스킬명을 접두사로 유지한다 (예: `code-convention-react`).
- **버전 관리:** 원본 스킬은 메이저 버전을 올리고, 새 스킬은 1.0.0으로 시작한다.
- **하위 호환성:** 원본 스킬을 참조하던 다른 스킬이 있으면, 영향도를 확인하고 필요 시 안내한다.

## 예외사항

### 대상 스킬이 없는 경우
지정 경로에 SKILL.md가 없으면 "지정된 경로에 SKILL.md가 없습니다."를 출력하고 종료한다.

### 이미 분리된 스킬
대상 스킬이 이미 확장 스킬 구조를 가지고 있으면 (다른 스킬이 이 스킬을 dependencies로 참조), 현재 구조를 표시하고 추가 분리가 필요한지 확인한다.

### community 스킬 대상
대상 스킬이 `community/` 디렉토리에 있으면:
- "커뮤니티 스킬은 직접 수정하지 않습니다. custom/으로 복사 후 리팩토링하시겠습니까?"를 `AskUserQuestion`으로 확인
- "복사 후 리팩토링" — `custom/`으로 복사한 후 리팩토링 진행
- "취소" — 종료

## Related Files

| File | Purpose |
|------|---------|
| `README.md` | 메인 스킬 목록 |
